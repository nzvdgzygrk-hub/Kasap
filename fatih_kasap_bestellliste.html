<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Fatih Kasap Bestellliste</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      max-width: 1200px;
    }
    h1 {
      margin-top: 0;
    }
    .lang-switch {
      margin-bottom: 15px;
    }
    .lang-switch button {
      padding: 6px 12px;
      margin-right: 8px;
      border: 1px solid #ccc;
      border-radius: 4px;
      background: #f5f5f5;
      cursor: pointer;
    }
    .lang-switch button.active {
      font-weight: bold;
      border-color: #000;
    }
    label {
      font-weight: bold;
    }
    select, input[type="text"], input[type="number"] {
      padding: 4px;
      margin: 4px 0;
      min-width: 200px;
    }
    button {
      padding: 6px 12px;
      margin: 4px 4px 8px 0;
      border-radius: 4px;
      border: 1px solid #ccc;
      cursor: pointer;
      background: #f5f5f5;
    }
    button:hover {
      background: #e9e9e9;
    }
    table {
      border-collapse: collapse;
      width: 100%;
      margin-top: 10px;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 6px;
      text-align: left;
    }
    th {
      background: #f0f0f0;
    }
    .info {
      font-size: 0.9em;
      color: #555;
      margin-top: 5px;
    }
    .message {
      margin-top: 8px;
      font-size: 0.9em;
      color: green;
    }
    .section {
      margin-top: 20px;
      margin-bottom: 10px;
    }
  </style>
</head>
<body>
  <h1 id="title">Fatih Kasap Bestellliste</h1>
  <div id="subtitle" class="info">
    Bestellmengen in Kilogramm für jede/n Besteller/in eintragen. Daten werden lokal im Browser gespeichert.
  </div>

  <!-- Sprachumschaltung -->
  <div class="lang-switch">
    <span id="langLabel">Sprache / Dil:</span>
    <button id="btnLangDE" class="active">Deutsch</button>
    <button id="btnLangTR">Türkçe</button>
  </div>

  <!-- Besteller-Verwaltung -->
  <div class="section">
    <label id="customerLabel" for="customerSelect">Besteller / Händler:</label><br>
    <select id="customerSelect"></select><br>
    <button id="btnAddCustomer">Besteller hinzufügen</button>
    <button id="btnDeleteCustomer">Besteller löschen</button>
    <div id="customerHint" class="info">
      Zum Hinzufügen oder Löschen ist ein Passwort nötig.
    </div>
  </div>

  <!-- Artikel-Tabelle -->
  <div class="section">
    <h2 id="itemsTitle">Artikel und Mengen (kg)</h2>
    <button id="btnClearData">Mengen für diesen Besteller löschen</button>
    <button id="btnClearAllData">Alle Mengen aller Besteller löschen</button>
    <div id="itemsContainer"></div>
    <div id="itemsHint" class="info">
      Bitte die Menge in Kilogramm eintragen. Beispiel: 5 oder 2.5
    </div>
  </div>

  <!-- Zusammenfassung -->
  <div class="section">
    <h2 id="summaryTitle">Gesamte Bestellübersicht</h2>
    <button id="btnCopySummary">Gesamte Liste kopieren</button>
    <div id="summaryHint" class="info">
      Kopiert die Bestellungen aller Besteller in den Zwischenspeicher, z.B. für WhatsApp.
    </div>
    <div id="message" class="message"></div>
  </div>

  <script>
    // Passwort für Besteller hinzufügen / löschen
    const PASSWORD = "Tavuk";

    // Artikelliste – Deutsch & Türkisch (erweitert für türkische Metzgerei)
    const ITEMS = [
      // Hähnchen / Tavuk
      { id: "chicken_breast",        de: "Hähnchenbrust",                       tr: "Tavuk göğsü" },
      { id: "chicken_innerfilet",    de: "Hähnchen-Innenfilet",                 tr: "Tavuk iç göğüs" },
      { id: "chicken_leg",           de: "Hähnchenschenkel (Keule)",            tr: "Tavuk but" },
      { id: "chicken_drumstick",     de: "Hähnchen-Unterschenkel (Drumsticks)", tr: "Tavuk baget" },
      { id: "chicken_thigh",         de: "Hähnchenoberkeule",                   tr: "Tavuk but üstü" },
      { id: "chicken_wing",          de: "Hähnchenflügel",                      tr: "Tavuk kanat" },
      { id: "chicken_whole",         de: "Ganzes Hähnchen",                     tr: "Bütün tavuk" },
      { id: "chicken_minced",        de: "Hähnchenhack",                        tr: "Tavuk kıyma" },
      { id: "chicken_liver",         de: "Hähnchenleber",                       tr: "Tavuk ciğer" },
      { id: "chicken_heart",         de: "Hähnchenherzen",                      tr: "Tavuk yürek" },

      // Pute / Hindi
      { id: "turkey_breast",         de: "Putenbrust",                          tr: "Hindi göğüs" },
      { id: "turkey_leg",            de: "Putenschenkel",                       tr: "Hindi but" },
      { id: "turkey_minced",         de: "Putenhack",                           tr: "Hindi kıyma" },

      // Rind / Dana
      { id: "beef_minced",           de: "Rinderhack (normal)",                 tr: "Dana kıyma (normal)" },
      { id: "beef_minced_fatty",     de: "Rinderhack (fettreich)",              tr: "Dana kıyma (yağlı)" },
      { id: "beef_stew",             de: "Rindfleisch gewürfelt (Gulasch)",     tr: "Dana kuşbaşı" },
      { id: "beef_steak",            de: "Rindersteak",                         tr: "Dana biftek" },
      { id: "beef_shoulder",         de: "Rinderschulter",                      tr: "Dana kol" },
      { id: "beef_leg",              de: "Rinderkeule",                         tr: "Dana but" },
      { id: "beef_neck",             de: "Rindernacken",                        tr: "Dana gerdan" },
      { id: "beef_shank",            de: "Rinderbeinscheibe",                   tr: "Dana incik" },
      { id: "beef_soup_meat",        de: "Rind Suppenfleisch",                  tr: "Dana çorbalık et" },
      { id: "beef_burger_mix",       de: "Hackfleisch für Burger",              tr: "Hamburgerlik kıyma" },

      // Lamm / Kuzu
      { id: "lamb_minced",           de: "Lammhack",                            tr: "Kuzu kıyma" },
      { id: "lamb_leg",              de: "Lammkeule",                           tr: "Kuzu but" },
      { id: "lamb_shoulder",         de: "Lammschulter",                        tr: "Kuzu kol" },
      { id: "lamb_neck",             de: "Lammnacken",                          tr: "Kuzu gerdan" },
      { id: "lamb_chops",            de: "Lammkotelett",                        tr: "Kuzu pirzola" },
      { id: "lamb_stew",             de: "Lammfleisch gewürfelt",               tr: "Kuzu kuşbaşı" },

      // Grill / Mangal – Kebab / Şiş
      { id: "adana_kebab_mix",       de: "Adana-Kebab-Fleisch (gewürzt)",       tr: "Adana kebap harcı (hazır)" },
      { id: "urfa_kebab_mix",        de: "Urfa-Kebab-Fleisch (mild)",           tr: "Urfa kebap harcı (az acılı)" },
      { id: "kofte_mix",             de: "Köfte-Fleisch (gewürzt)",             tr: "Köftelik kıyma (hazır)" },
      { id: "chicken_shish",         de: "Tavuk Şiş (mariniert)",               tr: "Tavuk şiş (marine)" },
      { id: "lamb_shish",            de: "Kuzu Şiş (mariniert)",                tr: "Kuzu şiş (marine)" },
      { id: "beef_shish",            de: "Dana Şiş (mariniert)",                tr: "Dana şiş (marine)" },
      { id: "chicken_wing_marinated",de: "Hähnchenflügel mariniert",            tr: "Marine tavuk kanat" },

      // Döner
      { id: "doner_beef",            de: "Dönerfleisch Rind (roh)",             tr: "Dana dönerlik et (çiğ)" },
      { id: "doner_chicken",         de: "Dönerfleisch Hähnchen (roh)",         tr: "Tavuk dönerlik et (çiğ)" },

      // Wurst & Spezialitäten
      { id: "sucuk",                 de: "Sucuk (Rindswurst)",                  tr: "Sucuk" },
      { id: "pastirma",              de: "Pastirma",                            tr: "Pastırma" },
      { id: "smoked_sausage",        de: "Räucherwurst gemischt",               tr: "Karışık füme sosis" },
      { id: "merguez",               de: "Merguez (Rind/Lamm)",                 tr: "Merguez (dana/kuzu)" },
      { id: "turkish_salami",        de: "Türkische Salami",                    tr: "Türk salam" },
      { id: "chicken_sausage",       de: "Geflügelwurst",                       tr: "Tavuk sosis" },
      { id: "beef_hotdog",           de: "Rinder-Hotdog-Wurst",                 tr: "Dana sosis" },

      // Innereien / Sakatat
      { id: "beef_liver",            de: "Rinderleber",                         tr: "Dana ciğer" },
      { id: "lamb_liver",            de: "Lammleber",                           tr: "Kuzu ciğer" },
      { id: "beef_heart",            de: "Rinderherz",                          tr: "Dana yürek" },
      { id: "lamb_heart",            de: "Lammherz",                            tr: "Kuzu yürek" },
      { id: "beef_kidney",           de: "Rinderniere",                         tr: "Dana böbrek" },
      { id: "lamb_kidney",           de: "Lammniere",                           tr: "Kuzu böbrek" },
      { id: "tripe_clean",           de: "Kutteln (geputzt)",                   tr: "İşkembe (temizlenmiş)" },
      { id: "tripe_dirty",           de: "Kutteln (ungeputzt)",                 tr: "İşkembe (çiğ/temiz)" },
      { id: "brain_lamb",            de: "Lammhirn",                            tr: "Kuzu beyin" },
      { id: "brain_beef",            de: "Rinderhirn",                          tr: "Dana beyin" },
      { id: "tongue_beef",           de: "Rinderzunge",                         tr: "Dana dil" },

      // Knochen & Suppenteile / Kemik & Çorbalık
      { id: "bones_soup",            de: "Knochen gemischt (Suppe)",            tr: "Çorbalık kemik" },
      { id: "bones_marrow",          de: "Markknochen",                         tr: "İlikli kemik" },
      { id: "lamb_head",             de: "Lammkopf",                            tr: "Kuzu kelle" },
      { id: "beef_head_meat",        de: "Kopffleisch Rind",                    tr: "Dana kelle eti" },
      { id: "feet_lamb",             de: "Lammfüße",                            tr: "Kuzu paça" },
      { id: "feet_beef",             de: "Rinderfüße",                          tr: "İnek paça" },

      // Extra / Diğer
      { id: "ground_meat_mixed",     de: "Gemischtes Hack (Rind+Lamm)",         tr: "Karışık kıyma (dana+kuzu)" },
      { id: "meatballs_ready",       de: "Fertige Köfte (roh)",                 tr: "Hazır köfte (çiğ)" },
      { id: "cigkofte_meat",         de: "Fleisch für Çiğköfte",                tr: "Çiğköftelik et" },
      { id: "kokorec_raw",           de: "Kokoreç (roh)",                       tr: "Çiğ kokoreç" },
      { id: "kokorec_ready",         de: "Kokoreç (gewürzt, fertig)",           tr: "Hazır kokoreç" }
    ];

    // Übersetzungen für UI-Texte
    const I18N = {
      de: {
        title: "Fatih Kasap Bestellliste",
        subtitle: "Bestellmengen in Kilogramm für jede/n Besteller/in eintragen. Daten werden lokal im Browser gespeichert.",
        langLabel: "Sprache / Dil:",
        customerLabel: "Besteller / Händler:",
        addCustomer: "Besteller hinzufügen",
        deleteCustomer: "Besteller löschen",
        customerHint: "Zum Hinzufügen oder Löschen ist ein Passwort nötig.",
        itemsTitle: "Artikel und Mengen (kg)",
        itemsHint: "Bitte die Menge in Kilogramm eintragen. Beispiel: 5 oder 2.5",
        summaryTitle: "Gesamte Bestellübersicht",
        copySummary: "Gesamte Liste kopieren",
        summaryHint: "Kopiert die Bestellungen aller Besteller in den Zwischenspeicher, z.B. für WhatsApp.",
        noCustomer: "Bitte zuerst einen Besteller anlegen.",
        passwordPrompt: "Bitte Passwort eingeben:",
        passwordWrong: "Falsches Passwort.",
        addCustomerName: "Name des Bestellers / Händlers:",
        deleteConfirm: "Diesen Besteller und alle seine Bestellungen wirklich löschen?",
        noCustomersForSummary: "Es sind noch keine Besteller angelegt.",
        summaryHeader: "Metzgerei-Gesamtbestellung:",
        summaryCustomerLabel: "Besteller",
        messageCopied: "Text wurde in die Zwischenablage kopiert.",
        messageFallback: "Text wurde markiert. Bitte manuell kopieren (Strg+C).",
        clearData: "Mengen für diesen Besteller löschen",
        clearedMessage: "Alle Mengen für diesen Besteller wurden gelöscht.",
        clearAllData: "Alle Mengen aller Besteller löschen",
        allClearedMessage: "Alle Mengen für alle Besteller wurden gelöscht.",
        deleteAllQuantitiesConfirm: "Wirklich ALLE Mengen aller Besteller löschen?"
      },
      tr: {
        title: "Fatih Kasap Sipariş Listesi",
        subtitle: "Her bir müşteri için kilogram cinsinden sipariş miktarlarını girin. Veriler tarayıcıda yerel olarak saklanır.",
        langLabel: "Dil / Sprache:",
        customerLabel: "Müşteri / Bayi:",
        addCustomer: "Müşteri ekle",
        deleteCustomer: "Müşteri sil",
        customerHint: "Ekleme veya silme için şifre gerekiyor.",
        itemsTitle: "Ürünler ve miktarlar (kg)",
        itemsHint: "Lütfen miktarı kilogram olarak girin. Örnek: 5 veya 2.5",
        summaryTitle: "Toplam sipariş özeti",
        copySummary: "Tüm listeyi kopyala",
        summaryHint: "Tüm müşterilerin siparişlerini panoya kopyalar, örn. WhatsApp için.",
        noCustomer: "Lütfen önce bir müşteri ekleyin.",
        passwordPrompt: "Lütfen şifreyi girin:",
        passwordWrong: "Yanlış şifre.",
        addCustomerName: "Müşteri / bayinin adı:",
        deleteConfirm: "Bu müşteriyi ve tüm siparişlerini silmek istiyor musunuz?",
        noCustomersForSummary: "Henüz müşteri eklenmedi.",
        summaryHeader: "Kasap toplam sipariş:",
        summaryCustomerLabel: "Müşteri",
        messageCopied: "Metin panoya kopyalandı.",
        messageFallback: "Metin işaretlendi. Lütfen elle kopyalayın (Ctrl+C).",
        clearData: "Bu müşteri için miktarları sil",
        clearedMessage: "Bu müşteri için tüm miktarlar silindi.",
        clearAllData: "Tüm müşterilerin miktarlarını sil",
        allClearedMessage: "Tüm müşteriler için tüm miktarlar silindi.",
        deleteAllQuantitiesConfirm: "Tüm müşterilerin miktarları tamamen silinsin mi?"
      }
    };

    // Zustand
    let state = {
      lang: "de",
      customers: [],
      selectedCustomerId: null,
      passwordValidUntil: 0 // Timestamp (ms) bis wann Passwort gültig ist
    };

    const STORAGE_KEY = "fatihKasapStateV1";

    // DOM-Elemente
    const titleEl = document.getElementById("title");
    const subtitleEl = document.getElementById("subtitle");
    const langLabelEl = document.getElementById("langLabel");
    const btnLangDE = document.getElementById("btnLangDE");
    const btnLangTR = document.getElementById("btnLangTR");
    const customerLabelEl = document.getElementById("customerLabel");
    const customerSelect = document.getElementById("customerSelect");
    const btnAddCustomer = document.getElementById("btnAddCustomer");
    const btnDeleteCustomer = document.getElementById("btnDeleteCustomer");
    const customerHintEl = document.getElementById("customerHint");
    const itemsTitleEl = document.getElementById("itemsTitle");
    const itemsContainer = document.getElementById("itemsContainer");
    const itemsHintEl = document.getElementById("itemsHint");
    const btnClearData = document.getElementById("btnClearData");
    const btnClearAllData = document.getElementById("btnClearAllData");
    const summaryTitleEl = document.getElementById("summaryTitle");
    const btnCopySummary = document.getElementById("btnCopySummary");
    const summaryHintEl = document.getElementById("summaryHint");
    const messageEl = document.getElementById("message");

    // Laden aus localStorage
    function loadState() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) return;
        const parsed = JSON.parse(raw);
        if (parsed && typeof parsed === "object") {
          state = Object.assign(state, parsed);
        }
      } catch (e) {
        console.error("Fehler beim Laden des Zustands:", e);
      }
    }

    function saveState() {
      try {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
      } catch (e) {
        console.error("Fehler beim Speichern des Zustands:", e);
      }
    }

    function getCurrentTranslations() {
      return I18N[state.lang] || I18N.de;
    }

    // Sprache setzen
    function setLanguage(lang) {
      state.lang = lang;
      const t = getCurrentTranslations();

      titleEl.textContent = t.title;
      subtitleEl.textContent = t.subtitle;
      langLabelEl.textContent = t.langLabel;
      customerLabelEl.textContent = t.customerLabel;
      btnAddCustomer.textContent = t.addCustomer;
      btnDeleteCustomer.textContent = t.deleteCustomer;
      customerHintEl.textContent = t.customerHint;
      itemsTitleEl.textContent = t.itemsTitle;
      itemsHintEl.textContent = t.itemsHint;
      summaryTitleEl.textContent = t.summaryTitle;
      btnCopySummary.textContent = t.copySummary;
      summaryHintEl.textContent = t.summaryHint;
      btnClearData.textContent = t.clearData;
      btnClearAllData.textContent = t.clearAllData;

      btnLangDE.classList.toggle("active", lang === "de");
      btnLangTR.classList.toggle("active", lang === "tr");

      renderCustomers();
      renderItemsTable();
    }

    // Passwortlogik: 2 Minuten gültig
    function isPasswordStillValid() {
      return Date.now() < (state.passwordValidUntil || 0);
    }

    function ensurePassword(callback) {
      const t = getCurrentTranslations();
      if (isPasswordStillValid()) {
        callback();
        return;
      }
      const pwd = prompt(t.passwordPrompt);
      if (pwd === null) return;
      if (pwd !== PASSWORD) {
        alert(t.passwordWrong);
        return;
      }
      // Passwort korrekt -> 2 Minuten gültig
      state.passwordValidUntil = Date.now() + 2 * 60 * 1000;
      saveState();
      callback();
    }

    // Besteller-Liste rendern
    function renderCustomers() {
      const t = getCurrentTranslations();
      customerSelect.innerHTML = "";

      if (!state.customers || state.customers.length === 0) {
        const opt = document.createElement("option");
        opt.value = "";
        opt.textContent = state.lang === "de" ? "— kein Besteller —" : "— müşteri yok —";
        customerSelect.appendChild(opt);
        state.selectedCustomerId = null;
        return;
      }

      state.customers.forEach(c => {
        const opt = document.createElement("option");
        opt.value = c.id;
        opt.textContent = c.name;
        if (c.id === state.selectedCustomerId) {
          opt.selected = true;
        }
        customerSelect.appendChild(opt);
      });

      // Falls ausgewählter nicht mehr existiert
      if (!state.customers.find(c => c.id === state.selectedCustomerId)) {
        state.selectedCustomerId = state.customers[0].id;
      }
      customerSelect.value = state.selectedCustomerId || "";
    }

    // Artikel-Tabelle rendern
    function renderItemsTable() {
      const t = getCurrentTranslations();
      itemsContainer.innerHTML = "";

      if (!state.selectedCustomerId) {
        itemsContainer.textContent = t.noCustomer;
        return;
      }

      const customer = state.customers.find(c => c.id === state.selectedCustomerId);
      if (!customer) {
        itemsContainer.textContent = t.noCustomer;
        return;
      }

      if (!customer.orders) {
        customer.orders = {};
      }

      const table = document.createElement("table");
      const thead = document.createElement("thead");
      const headerRow = document.createElement("tr");

      const thItem = document.createElement("th");
      thItem.textContent = state.lang === "de" ? "Artikel" : "Ürün";
      const thQty = document.createElement("th");
      thQty.textContent = "kg";

      headerRow.appendChild(thItem);
      headerRow.appendChild(thQty);
      thead.appendChild(headerRow);
      table.appendChild(thead);

      const tbody = document.createElement("tbody");

      ITEMS.forEach(item => {
        const row = document.createElement("tr");
        const tdItem = document.createElement("td");
        tdItem.textContent = state.lang === "de" ? item.de : item.tr;

        const tdQty = document.createElement("td");
        const input = document.createElement("input");
        input.type = "number";
        input.min = "0";
        input.step = "0.01";
        input.style.width = "80px";

        const val = customer.orders[item.id];
        input.value = (typeof val === "number" && !isNaN(val)) ? val : "";

        input.addEventListener("input", () => {
          const raw = input.value.trim();
          if (raw === "") {
            delete customer.orders[item.id];
          } else {
            const num = parseFloat(raw.replace(",", "."));
            if (isNaN(num) || num < 0) {
              delete customer.orders[item.id];
            } else {
              customer.orders[item.id] = num;
            }
          }
          saveState();
        });

        tdQty.appendChild(input);
        row.appendChild(tdItem);
        row.appendChild(tdQty);
        tbody.appendChild(row);
      });

      table.appendChild(tbody);
      itemsContainer.appendChild(table);
    }

    // Zusammenfassung erstellen
    function buildSummaryText() {
      const t = getCurrentTranslations();
      if (!state.customers || state.customers.length === 0) {
        return "";
      }

      let lines = [];
      lines.push(t.summaryHeader);
      lines.push("");

      state.customers.forEach(c => {
        if (!c.orders) return;
        const itemLines = [];
        ITEMS.forEach(item => {
          const val = c.orders[item.id];
          if (typeof val === "number" && !isNaN(val) && val > 0) {
            const name = state.lang === "de" ? item.de : item.tr;
            itemLines.push("- " + name + ": " + val + " kg");
          }
        });
        if (itemLines.length > 0) {
          lines.push(t.summaryCustomerLabel + ": " + c.name);
          lines = lines.concat(itemLines);
          lines.push("");
        }
      });

      return lines.join("\n");
    }

    // Mengen für ausgewählten Besteller löschen
    function clearCurrentCustomerData() {
      const t = getCurrentTranslations();
      if (!state.selectedCustomerId) {
        alert(t.noCustomer);
        return;
      }
      const customer = state.customers.find(c => c.id === state.selectedCustomerId);
      if (!customer) {
        alert(t.noCustomer);
        return;
      }
      customer.orders = {};
      saveState();
      renderItemsTable();
      messageEl.textContent = t.clearedMessage;
      setTimeout(() => (messageEl.textContent = ""), 2500);
    }

    // ALLE Mengen aller Besteller löschen
    function clearAllCustomersData() {
      const t = getCurrentTranslations();

      if (!state.customers || state.customers.length === 0) {
        alert(t.noCustomer);
        return;
      }

      if (!confirm(t.deleteAllQuantitiesConfirm)) {
        return;
      }

      state.customers.forEach(c => {
        c.orders = {};
      });

      saveState();
      renderItemsTable();

      messageEl.textContent = t.allClearedMessage;
      setTimeout(() => (messageEl.textContent = ""), 3000);
    }

    // Event-Listener
    btnLangDE.addEventListener("click", () => {
      setLanguage("de");
      saveState();
    });

    btnLangTR.addEventListener("click", () => {
      setLanguage("tr");
      saveState();
    });

    customerSelect.addEventListener("change", () => {
      state.selectedCustomerId = customerSelect.value || null;
      saveState();
      renderItemsTable();
    });

    btnAddCustomer.addEventListener("click", () => {
      const t = getCurrentTranslations();
      ensurePassword(() => {
        const name = prompt(t.addCustomerName);
        if (!name) return;
        const id = "c_" + Date.now() + "_" + Math.floor(Math.random() * 100000);
        state.customers.push({ id, name: name.trim(), orders: {} });
        state.selectedCustomerId = id;
        saveState();
        renderCustomers();
        renderItemsTable();
      });
    });

    btnDeleteCustomer.addEventListener("click", () => {
      const t = getCurrentTranslations();
      if (!state.selectedCustomerId) {
        alert(t.noCustomer);
        return;
      }
      ensurePassword(() => {
        if (!confirm(t.deleteConfirm)) return;
        state.customers = state.customers.filter(c => c.id !== state.selectedCustomerId);
        state.selectedCustomerId = state.customers.length > 0 ? state.customers[0].id : null;
        saveState();
        renderCustomers();
        renderItemsTable();
      });
    });

    btnClearData.addEventListener("click", () => {
      clearCurrentCustomerData();
    });

    btnClearAllData.addEventListener("click", () => {
      clearAllCustomersData();
    });

    btnCopySummary.addEventListener("click", () => {
      const t = getCurrentTranslations();
      const text = buildSummaryText();
      if (!text.trim()) {
        alert(t.noCustomersForSummary);
        return;
      }

      messageEl.textContent = "";
      if (navigator.clipboard && navigator.clipboard.writeText) {
        navigator.clipboard.writeText(text)
          .then(() => {
            messageEl.textContent = t.messageCopied;
          })
          .catch(() => {
            fallbackCopyText(text, t);
          });
      } else {
        fallbackCopyText(text, t);
      }
    });

    function fallbackCopyText(text, t) {
      const textarea = document.createElement("textarea");
      textarea.value = text;
      document.body.appendChild(textarea);
      textarea.select();
      try {
        document.execCommand("copy");
        messageEl.textContent = t.messageCopied;
      } catch (e) {
        messageEl.textContent = t.messageFallback;
      }
      document.body.removeChild(textarea);
    }

    // Initialisierung
    loadState();
    setLanguage(state.lang || "de");
    renderCustomers();
    renderItemsTable();
  </script>
</body>
</html>
